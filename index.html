<!doctype html>
<html lang="ru">
  <head>
    <title>&lt;rosamundi 〔✛〕 web-zin&gt;</title>
    <meta charset="utf-8">
    <meta name="description" content="&lt;poetic&gt; web-zin">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link type="text/css" href="./styles.css" rel="stylesheet"/>
    <meta name="Cache-Control" content="max-age=31536000, must-revalidate">
    <meta name="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';">
    <meta name="keywords" content="rosamundi, poetry, art">
    <meta name="author" content="rosamundi">
    <meta name="referrer" content="no-referrer">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
  </head>


  <!-- Поддержка Safari для import maps -->
<script async src="https://ga.jspm.io/npm:es-module-shims@1.7.1/dist/es-module-shims.js"></script>

<!-- Подключаем Three.js -->
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@^0.168.0/build/three.module.min.js"
  }
}
</script>

<!-- Подключаем модульную версию model-viewer и эффекты -->
<script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer/dist/model-viewer-module.min.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer-effects/dist/model-viewer-effects.min.js"></script>


  <body>
    <div class="wrapper-h1"><h1>rosamundi 〔✛〕 web-zin</h1></div>
    
    <div class="wrapper-li">
      <ul id="poem-list"></ul>
    </div>
    
    <div id="popup" class="popup">
      <div class="popup-content"> 
          <p id="popup-text"></p>
      </div>
    </div>
    
    <script>
      fetch('poems.json')
        .then(response => response.json())
        .then(data => {
          const poemList = document.getElementById('poem-list');
    
          data.poems.forEach(poem => {
            const li = document.createElement('li');
            li.classList.add('poem-item'); // Добавляем класс для стилей
    
            // Создаем контейнер для информации о поэме
            const poemContainer = document.createElement('div');
            poemContainer.classList.add('poem-container'); // Добавляем класс для оформления
    
            // Текст "poem"
            const poemText = document.createElement('span');
            poemText.textContent = `poem`;
            poemText.className = 'poem-text';
            poemContainer.appendChild(poemText);
    
            // Символ "〔✛〕"
            const poemSymbol = document.createElement('span');
            poemSymbol.textContent = `〔✛〕`;
            poemSymbol.className = 'poem-symbol';
            poemContainer.appendChild(poemSymbol);
    
            // Информация о поэме: ID и автор
            const poemInfo = document.createElement('span');
            poemInfo.textContent = `${poem.id} ${poem.author}`;
            poemInfo.className = 'poem-info';
            poemContainer.appendChild(poemInfo);
    
            // Вставляем контейнер в элемент списка
            li.appendChild(poemContainer);
    
            // Устанавливаем data-content для li, чтобы идентифицировать содержимое
            li.setAttribute('data-content', poem.content);
    
            // Добавляем обработчик клика для открытия попапа
            li.addEventListener('click', () => {
              const popupText = document.getElementById('popup-text');
              popupText.textContent = poem.content; // Показываем текст в попапе
    
              const popup = document.getElementById('popup');
              const popupContent = document.querySelector('.popup-content');
              popup.style.display = 'flex'; // Показываем попап
    
              // Генерируем случайный угол наклона от -5 до 5 градусов
              const randomRotate = Math.floor(Math.random() * 11) - 5;
              popupContent.style.transform = `rotate(${randomRotate}deg)`;
            });
    
            // Вставляем элемент списка в poemList
            poemList.appendChild(li);
          });
    
          // Закрытие попапа при клике вне его области
          window.addEventListener('click', (event) => {
            const popup = document.getElementById('popup');
            const popupContent = document.querySelector('.popup-content');
    
            if (event.target === popup) {
              popup.style.display = 'none'; // Скрываем попап
              popupContent.style.transform = 'rotate(0deg)'; // Сбрасываем наклон
            }
          });
        });
    </script>
    
    <!-- <model-viewer> HTML element -->
      <model-viewer src="dried_rose_.rawscan.glb" 
      ar 
      ar-modes="webxr scene-viewer quick-look" 
      camera-controls 
      tone-mapping="agx" 
      poster="poster.webp" 
      shadow-intensity="1.25" 
      environment-image="whipple_creek_regional_park_04_1k.hdr" 
      exposure="1.21" 
      shadow-softness="0.3" 
      auto-rotate
      style="background-color: black;">
      
      
      <!-- Эффекты постобработки -->
      <effect-composer>
        <glitch-effect strength="0.7" mode="sporadic"></glitch-effect>
        <pixelate-effect granularity="5" blend-mode="skip"></pixelate-effect>
        <ssao-effect blend-mode="skip"></ssao-effect>
        
        <bloom-effect></bloom-effect>
        <selective-bloom-effect strength="5" radius="0.7" threshold="0.1"></selective-bloom-effect>
      </effect-composer>
    
    </model-viewer>
          <div class="progress-bar hide" slot="progress-bar">
          <div class="update-bar"></div>
      </div>
    </model-viewer>  
  
    <div class="custom-audio-player">
      <button id="playPauseBtn" class="play-btn">Play</button>
      <button id="muteBtn" class="mute-btn">Mute</button>
    </div>
    
    <audio id="audioPlayer" src="Elephant Woman.mp3"></audio>
    
    
    <script src="script.js"></script>
    
    <!-- Loads <model-viewer> for browsers: -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
  </body>
</html>
